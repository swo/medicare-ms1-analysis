---
title: "Carrier and outpatient claims"
author: "Scott Olesen"
date: "4 March 2017"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=4, 
                      echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE)
```

# Methods

I use the 2011 data.

```{r load_data}
n_max=1e4

carrier_count = read_tsv('../../data/carrier_count_2011.tsv', n_max=n_max) %>%
  rename(bene_id=BENE_ID, carrier_count=n_from_dates)
outpatient_count = read_tsv('../../data/outpatient_count_2011.tsv', n_max=n_max) %>%
  rename(bene_id=BENE_ID, outpatient_count=n_from_dates)
inpatient_count = read_tsv('../../data/inpatient_count_2011.tsv', n_max=n_max) %>%
  rename(bene_id=BENE_ID, inpatient_count=n_from_dates)
```

## Carrier character information

Are there repetitions among the carrier data? Yes. Mostly these are for zipcodes: the same beneficiary can have claims associated to multiple zipcodes. Many of these zipcodes are nearby (e.g., one in the suburbs and one in the city), and for the most part, one of the zipcodes is the same as the zipcode that we have for that beneficiary as their home address. In a few cases, the claims zipcodes include claims from multiple states (which I guess means that they were traveling and got ill, or that they have multiple homes, or stay with family, etc.).

In a few cases, a beneficiary has multiple birth dates. I looked at a few cases, which just looked like typos or small errors (e.g., "14" and "19" for the day of the month). One of the dates matched the one in the beneficiary information.

```{r}
library(stringr)

bene_char = read_tsv('../bene_2011.tsv') %>%
  select(bene_id, zipcode)

carrier_char = read_tsv('../../data/carrier_char_2011.tsv', n_max=n_max) %>%
  rename(bene_id=BENE_ID, date_of_birth=DOB_DT, zipcode=ZIP_CD) %>%
  mutate(date_of_birth=dmy(date_of_birth), zipcode=str_sub(zipcode, 1, 5))

repeated_benes = carrier_char %>%
  filter(duplicated(bene_id)) %>%
  select(bene_id) %>%
  distinct() %>%
  left_join(carrier_char, by='bene_id') %>%
  left_join(bene_char, by='bene_id', suffix=c('.carrier', '.bene'))
```

