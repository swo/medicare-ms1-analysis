---
title: "Summary of consumption in Medicare Part D"
author: "Scott Olesen"
date: "1/19/2017"
bibliography: "refs.bib"
output: html_document
---

This summary is modeled after @hicks-us-2015. That study, which used the IMS Health Xponent database to infer the number of prescriptions per capita, reported higher prescription rates than what we observe here. In that paper, the number of prescriptions per 1,000 people year (PKPY) is approximately 1,000 for people over 65. In this data, we find that number to be between 600 (in 2011) and 750 (in 2012). Our value is more similar to a report that used the National Ambulatory Care Survey (NAMCS) and National Hospital Ambulatory Care Survey (NHAMCS) rather than the Xponent data. That report estimated about 500 PKPY [@flemingdutra-prevalence-2016]. A third report, which used the Xponent database, reported that prescriptions fell from about 1,000 PKPY in 1996 to about 600 PKPY in 2003 [@hicks-outpatient-2011].

```{r load_data, echo=FALSE}
library(knitr)
dat = read_tsv('dat.tsv', progress=FALSE, col_types='cccd') %>%
  rename(rx=rx_per_1k_ppl) %>%
  mutate(rx=round(rx))
```

# Antibiotic consumption by class

Our data for antibiotic class roughly correspond to those reported in @hicks-us-2015, when allowing for the fact that their results have about 40% higher consumption overall. The striking difference is a in consumption of quinolones: in our 2011 data, quinolones are the most-prescribed class and account for 127 PKPY. In their data, quinolones are the fourth-most-prescribed class and account for 89 PKPY (adjusted to approximately $90 \times 0.6 = 54$).

```{r by_class, echo=FALSE}
top_abx_names = dat %>%
  filter(year=='2011', type=='rx_by_class') %>%
  arrange(desc(rx)) %>%
  head(9) %$%
  field

dat %>%
  filter(type=='rx_by_class') %>%
  mutate(field=if_else(field %in% top_abx_names, field, 'other')) %>% 
  group_by(year, field) %>%
  summarize(rx=sum(rx)) %>%
  ungroup %>%
  spread(year, rx) %>%
  {
    other_row = filter(., field=='other')
    most_rows = filter(., field!='other') %>% arrange(desc(`2011`))
    bind_rows(most_rows, other_row)
  } %>%
  rename(antibiotic=field) %>%
  kable
```

# Most-prescribed antibiotics

Our data for the most prescribed individual antibiotics also generally accords with @hicks-us-2015 (again, allowing for the 40% discrepancy). The major difference is that ciprofloxacin consumption is greater in our data and amoxicillin (and augmentin) consumption are greater in their data. The reduced consumption of amoxicillin in our data could be explained by the fact that our population is older.

```{r, echo=FALSE}
dat %>%
  filter(type=='top_abx_rx') %>%
  select(-type) %>% 
  spread(year, rx) %>%
  arrange(desc(`2011`)) %>%
  rename(antibiotic=field) %>%
  kable
```

# Consumption by sex

Our result, that the consumption of antibiotics by women and men is in a 3:2 ratio, agrees with the result in @hicks-us-2015.

```{r, echo=FALSE}
table_f = function(x) {
  dat %>%
    filter(type==x) %>%
    select(-type) %>%
    spread(year, rx) %>%
    arrange(desc(`2011`))
}
table_f('rx_by_sex') %>% rename(sex=field) %>% filter(sex != 'unknown') %>% kable
```

# Consumption by region

```{r, echo=FALSE}
table_f('rx_by_region') %>% rename(region=field) %>% kable
```
  
# Consumption by age

When stratifying by age, @hicks-us-2015 places all people 65 or older into one stratum. Here I stratify within this population. Excepting the beneficiaries under 65, older beneficiaries tend to consume more antibiotics. The beneficiaries under 65 qualify for Medicare because they are disabled, have end stage renal disease, or ALS, which might contribute to their increased consumption of antibiotics.

```{r, echo=FALSE}
dat %>%
  filter(type=='rx_by_age') %>%
  select(-type) %>%
  spread(year, rx) %>%
  arrange(field) %>%
  rename(age=field) %>%
  kable
```